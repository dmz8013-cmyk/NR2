{% extends "layouts/base.html" %}
{% block title %}ë‰´ìŠ¤ í¸í–¥ ë¶„ì„ - NR2 Network{% endblock %}

{% block extra_css %}
<style>
.bias-bar{height:8px;border-radius:4px;overflow:hidden;display:flex}
.bias-left{background:#3B82F6}.bias-center{background:#9CA3AF}.bias-right{background:#EF4444}
.article-card{transition:all .2s;border:1px solid rgba(0,0,0,.06)}
.article-card:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(0,0,0,.1)}
</style>
{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto px-4 py-8">
  <div class="flex items-center justify-between mb-8">
    <div>
      <h1 class="text-3xl font-black text-gray-900">ğŸ“Š ë‰´ìŠ¤ í¸í–¥ ë¶„ì„</h1>
      <p class="text-gray-500 mt-1">ì‹œë¯¼ê³¼ ì „ë¬¸ê°€ê°€ í•¨ê»˜ íŒë‹¨í•˜ëŠ” ë‰´ìŠ¤ í¸í–¥ ì§€ìˆ˜</p>
    </div>
    {% if current_user.is_authenticated and current_user.verify_tier != 'bronze' %}
    <a href="{{ url_for('bias.submit') }}" class="bg-amber-500 hover:bg-amber-600 text-white font-bold py-2 px-6 rounded-xl transition">+ ê¸°ì‚¬ ë“±ë¡</a>
    {% endif %}
  </div>

  {% if not current_user.is_authenticated %}
  <div class="bg-amber-50 border border-amber-200 rounded-xl p-4 mb-6 text-sm text-amber-800">
    ğŸ”’ í¸í–¥ íˆ¬í‘œì— ì°¸ì—¬í•˜ë ¤ë©´ <a href="{{ url_for('auth.login') }}" class="font-bold underline">ë¡œê·¸ì¸</a> í›„ ë³¸ì¸ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.
  </div>
  {% elif current_user.verify_tier == 'bronze' %}
  <div class="bg-blue-50 border border-blue-200 rounded-xl p-4 mb-6 text-sm text-blue-800">
    ğŸ”’ í¸í–¥ íˆ¬í‘œ ì°¸ì—¬ë¥¼ ìœ„í•´ ë³¸ì¸ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤. í”„ë¡œí•„ì—ì„œ ì¸ì¦ì„ ì§„í–‰í•˜ì„¸ìš”.
  </div>
  {% endif %}

  <div class="grid gap-4">
    {% for article in articles.items %}
    <a href="{{ url_for('bias.detail', article_id=article.id) }}" class="article-card bg-white rounded-xl p-5 block">
      <div class="flex items-start justify-between gap-4">
        <div class="flex-1 min-w-0">
          <div class="flex items-center gap-2 mb-2">
            {% if article.source %}
            <span class="text-xs font-semibold px-2 py-0.5 rounded bg-gray-100 text-gray-600">{{ article.source }}</span>
            {% endif %}
            {% if article.bias_label == 'left' %}
            <span class="text-xs font-bold px-2 py-0.5 rounded bg-blue-100 text-blue-700">â—€ ì§„ë³´í¸í–¥</span>
            {% elif article.bias_label == 'right' %}
            <span class="text-xs font-bold px-2 py-0.5 rounded bg-red-100 text-red-700">ë³´ìˆ˜í¸í–¥ â–¶</span>
            {% elif article.bias_label == 'center' %}
            <span class="text-xs font-bold px-2 py-0.5 rounded bg-gray-100 text-gray-700">âš– ì¤‘ë„</span>
            {% else %}
            <span class="text-xs font-bold px-2 py-0.5 rounded bg-yellow-100 text-yellow-700">ğŸ“Š ì§‘ê³„ì¤‘</span>
            {% endif %}
          </div>
          <h3 class="font-bold text-gray-900 mb-2 line-clamp-2">{{ article.title }}</h3>
          {% if article.vote_total >= 10 %}
          <div class="bias-bar w-full max-w-md mb-2">
            <div class="bias-left" style="width:{{ article.left_pct }}%"></div>
            <div class="bias-center" style="width:{{ article.center_pct }}%"></div>
            <div class="bias-right" style="width:{{ article.right_pct }}%"></div>
          </div>
          <div class="flex gap-4 text-xs text-gray-400">
            <span>â—€ {{ article.left_pct }}%</span>
            <span>âš– {{ article.center_pct }}%</span>
            <span>{{ article.right_pct }}% â–¶</span>
            <span class="ml-auto">{{ article.vote_total }}ëª… ì°¸ì—¬</span>
          </div>
          {% else %}
          <p class="text-xs text-gray-400">{{ article.vote_total }}ëª… ì°¸ì—¬ Â· 10ëª… ì´ìƒ ì‹œ ê²°ê³¼ ê³µê°œ</p>
          {% endif %}
        </div>
      </div>
    </a>
    {% else %}
    <div class="text-center py-16 text-gray-400">
      <p class="text-4xl mb-4">ğŸ“°</p>
      <p>ì•„ì§ ë“±ë¡ëœ ê¸°ì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
      {% if current_user.is_authenticated and current_user.verify_tier != 'bronze' %}
      <a href="{{ url_for('bias.submit') }}" class="inline-block mt-4 text-amber-600 font-bold hover:underline">ì²« ê¸°ì‚¬ë¥¼ ë“±ë¡í•´ë³´ì„¸ìš”!</a>
      {% endif %}
    </div>
    {% endfor %}
  </div>

  {% if articles.pages > 1 %}
  <div class="flex justify-center gap-2 mt-8">
    {% for p in articles.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
      {% if p %}
        <a href="{{ url_for('bias.index', page=p) }}" class="px-3 py-1 rounded-lg text-sm {% if p == articles.page %}bg-amber-500 text-white{% else %}bg-gray-100 text-gray-600 hover:bg-gray-200{% endif %}">{{ p }}</a>
      {% else %}
        <span class="px-2 text-gray-400">...</span>
      {% endif %}
    {% endfor %}
  </div>
  {% endif %}
</div>
{% endblock %}
