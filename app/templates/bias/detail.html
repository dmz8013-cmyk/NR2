{% extends "layouts/base.html" %}
{% block title %}{{ article.title }} - í¸í–¥ ë¶„ì„{% endblock %}

{% block extra_css %}
<style>
.bias-bar-lg{height:16px;border-radius:8px;overflow:hidden;display:flex}
.bias-left{background:#3B82F6}.bias-center{background:#9CA3AF}.bias-right{background:#EF4444}
.vote-btn{transition:all .2s}.vote-btn:hover{transform:scale(1.03)}
</style>
{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto px-4 py-8">
  <a href="{{ url_for('bias.index') }}" class="text-gray-400 hover:text-gray-600 text-sm mb-4 inline-block">&larr; ëª©ë¡ìœ¼ë¡œ</a>

  <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
    <div class="flex items-center gap-2 mb-3">
      {% if article.source %}
      <span class="text-xs font-semibold px-2 py-1 rounded bg-gray-100 text-gray-600">{{ article.source }}</span>
      {% endif %}
      <span class="text-xs text-gray-400">{{ article.created_at.strftime('%Y.%m.%d %H:%M') }}</span>
    </div>

    <h1 class="text-2xl font-black text-gray-900 mb-3">{{ article.title }}</h1>

    {% if article.summary %}
    <p class="text-gray-600 text-sm mb-4 leading-relaxed">{{ article.summary }}</p>
    {% endif %}

    <a href="{{ article.url }}" target="_blank" rel="noopener" class="inline-block text-sm text-blue-600 hover:underline mb-6">ğŸ”— ì›ë¬¸ ë³´ê¸° â†’</a>

    {% if article.vote_total >= 10 %}
    <div class="bg-gray-50 rounded-xl p-5 mb-6">
      <p class="text-sm font-bold text-gray-700 mb-3">ğŸ“Š í¸í–¥ ë¶„ì„ ê²°ê³¼</p>
      <div class="bias-bar-lg w-full mb-3">
        <div class="bias-left" style="width:{{ article.left_pct }}%"></div>
        <div class="bias-center" style="width:{{ article.center_pct }}%"></div>
        <div class="bias-right" style="width:{{ article.right_pct }}%"></div>
      </div>
      <div class="flex justify-between text-sm">
        <span class="text-blue-600 font-bold">â—€ ì§„ë³´ {{ article.left_pct }}%</span>
        <span class="text-gray-500 font-bold">âš– ì¤‘ë„ {{ article.center_pct }}%</span>
        <span class="text-red-600 font-bold">ë³´ìˆ˜ {{ article.right_pct }}% â–¶</span>
      </div>
      <p class="text-xs text-gray-400 mt-2 text-center">{{ article.vote_total }}ëª… ì°¸ì—¬</p>
    </div>
    {% else %}
    <div class="bg-yellow-50 rounded-xl p-5 mb-6 text-center">
      <p class="text-amber-700 font-bold mb-1">ğŸ“Š ì§‘ê³„ì¤‘</p>
      <p class="text-sm text-amber-600">{{ article.vote_total }}ëª… ì°¸ì—¬ Â· {{ 10 - article.vote_total }}ëª… ë” ì°¸ì—¬í•˜ë©´ ê²°ê³¼ê°€ ê³µê°œë©ë‹ˆë‹¤</p>
    </div>
    {% endif %}

    {% if current_user.is_authenticated and current_user.verify_tier != 'bronze' %}
    <div class="border-t pt-6">
      <p class="text-sm font-bold text-gray-700 mb-4">ì´ ê¸°ì‚¬ì˜ í¸í–¥ì„ íŒë‹¨í•´ì£¼ì„¸ìš”</p>
      <form method="POST" action="{{ url_for('bias.vote', article_id=article.id) }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <div class="grid grid-cols-3 gap-3">
          <button type="submit" name="bias" value="left" class="vote-btn rounded-xl p-4 text-center border-2 {% if user_vote and user_vote.bias == 'left' %}border-blue-500 bg-blue-50{% else %}border-gray-200 hover:border-blue-300 hover:bg-blue-50{% endif %}">
            <div class="text-2xl mb-1">â—€</div>
            <div class="font-bold text-sm text-blue-600">ì§„ë³´í¸í–¥</div>
          </button>
          <button type="submit" name="bias" value="center" class="vote-btn rounded-xl p-4 text-center border-2 {% if user_vote and user_vote.bias == 'center' %}border-gray-500 bg-gray-50{% else %}border-gray-200 hover:border-gray-400 hover:bg-gray-50{% endif %}">
            <div class="text-2xl mb-1">âš–</div>
            <div class="font-bold text-sm text-gray-600">ì¤‘ë„/ì‚¬ì‹¤</div>
          </button>
          <button type="submit" name="bias" value="right" class="vote-btn rounded-xl p-4 text-center border-2 {% if user_vote and user_vote.bias == 'right' %}border-red-500 bg-red-50{% else %}border-gray-200 hover:border-red-300 hover:bg-red-50{% endif %}">
            <div class="text-2xl mb-1">â–¶</div>
            <div class="font-bold text-sm text-red-600">ë³´ìˆ˜í¸í–¥</div>
          </button>
        </div>
      </form>
      {% if user_vote %}
      <p class="text-xs text-gray-400 mt-3 text-center">íˆ¬í‘œë¥¼ ë³€ê²½í•˜ë ¤ë©´ ë‹¤ë¥¸ ì˜µì…˜ì„ í´ë¦­í•˜ì„¸ìš”</p>
      {% endif %}
    </div>
    {% elif not current_user.is_authenticated %}
    <div class="border-t pt-6 text-center">
      <p class="text-gray-500 text-sm mb-3">í¸í–¥ íˆ¬í‘œì— ì°¸ì—¬í•˜ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</p>
      <a href="{{ url_for('auth.login') }}" class="inline-block bg-amber-500 text-white font-bold py-2 px-6 rounded-xl">ë¡œê·¸ì¸</a>
    </div>
    {% else %}
    <div class="border-t pt-6 text-center">
      <p class="text-gray-500 text-sm">ğŸ”’ ë³¸ì¸ì¸ì¦ í›„ íˆ¬í‘œì— ì°¸ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
