{% extends "layouts/base.html" %}
{% from "layouts/pagination.html" import render_pagination %}

{% block title %}{{ board_name }} - NR2 Network{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- Board Header -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
        <div class="flex justify-between items-center mb-4">
            <h1 class="text-3xl font-bold text-gray-900">{{ board_name }}</h1>
            {% if current_user.is_authenticated and (board_type != 'aesa' or current_user.is_admin) %}
            <a href="{{ url_for('boards.write', board_type=board_type) }}"
               class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700">
                글쓰기
            </a>
            {% endif %}
        </div>

        <!-- Search Form -->
        <form method="GET" action="{{ url_for('boards.board', board_type=board_type) }}" class="mt-4">
            <div class="flex gap-2">
                <select name="type" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="all" {% if search_type == 'all' %}selected{% endif %}>전체</option>
                    <option value="title" {% if search_type == 'title' %}selected{% endif %}>제목</option>
                    <option value="content" {% if search_type == 'content' %}selected{% endif %}>내용</option>
                    <option value="author" {% if search_type == 'author' %}selected{% endif %}>작성자</option>
                </select>
                <div class="flex-1 relative">
                    <input type="text"
                           name="q"
                           value="{{ search_query or '' }}"
                           placeholder="검색어를 입력하세요..."
                           class="w-full px-4 py-2 pr-10 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <button type="submit" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                        </svg>
                    </button>
                </div>
                {% if search_query %}
                <a href="{{ url_for('boards.board', board_type=board_type) }}"
                   class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                    초기화
                </a>
                {% endif %}
            </div>
        </form>

        <!-- Search Result Info -->
        {% if search_query %}
        <div class="mt-3 text-sm text-gray-600">
            <span class="font-semibold">"{{ search_query }}"</span> 검색 결과
            {% if search_type != 'all' %}
            ({{ {'title': '제목', 'content': '내용', 'author': '작성자'}[search_type] }}에서)
            {% endif %}
        </div>
        {% endif %}
    </div>

    <!-- Posts List -->
    <div class="bg-white rounded-lg shadow-md overflow-hidden">
        {% if posts %}
        <div class="divide-y divide-gray-200">
            {% for post in posts %}
            <a href="{{ url_for('boards.view', board_type=board_type, post_id=post.id) }}"
               class="block hover:bg-gray-50 transition-colors p-6">
                <div class="flex justify-between items-start">
                    <div class="flex-1">
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">
                            {{ post.title }}
                        </h3>
                        <div class="flex items-center text-sm text-gray-500 space-x-4">
                            <span>{{ post.author.nickname }}</span>
                            <span>{{ post.created_at.strftime('%Y-%m-%d %H:%M') }}</span>
                            <span class="flex items-center">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                </svg>
                                {{ post.views }}
                            </span>
                            <span class="flex items-center text-red-500">
                                <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"/>
                                </svg>
                                {{ post.likes_count }}
                            </span>
                            <span class="flex items-center">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                                </svg>
                                {{ post.comments_count }}
                            </span>
                        </div>
                    </div>
                    {% if post.images.first() %}
                    <div class="ml-4">
                        <img src="{{ url_for('static', filename='uploads/' + post.images.first().filename) }}"
                             alt="Thumbnail"
                             class="w-16 h-16 object-cover rounded">
                    </div>
                    {% endif %}
                </div>
            </a>
            {% endfor %}
        </div>
        {% else %}
        <div class="text-center py-12 text-gray-500">
            <p class="text-lg">아직 게시글이 없습니다.</p>
            {% if current_user.is_authenticated %}
            <p class="mt-2">첫 번째 게시글을 작성해보세요!</p>
            {% endif %}
        </div>
        {% endif %}
    </div>

    <!-- Pagination -->
    {% if posts %}
    {{ render_pagination(pagination, 'boards.board', board_type, search_query, search_type) }}
    {% endif %}
</div>
{% endblock %}
